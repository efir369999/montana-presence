# FIDO2 в консенсусе

**Биометрическая верификация на уровне протокола**
**Montana Protocol v1.0**

---

## Абстракт

Montana — первый блокчейн, где биометрическая верификация (FIDO2/WebAuthn) интегрирована непосредственно в консенсус. Verified User должен физически подтвердить присутствие (касание) и пройти биометрию (отпечаток/лицо) для участия в производстве блоков.

**Ключевое отличие:**
```
Другие блокчейны: приватный ключ = право голоса
Montana: приватный ключ + биометрия = право голоса
```

---

## 1. Введение

### 1.1 Проблема ключей

| Система | Авторизация | Проблема |
|---------|-------------|----------|
| Bitcoin | Приватный ключ | Ключ можно украсть |
| Ethereum | Приватный ключ | Ключ можно скопировать |
| Биржи | 2FA (TOTP) | Seed можно украсть |
| **Montana** | **FIDO2 + ключ** | **Нужен палец/лицо** |

### 1.2 Решение Montana

Verified User (20% консенсуса) требует двух факторов:
1. Приватный ключ (что-то, что ты ИМЕЕШЬ)
2. Биометрия (что-то, что ты ЕСТЬ)

---

## 2. Архитектура

### 2.1 FIDO2 флаги в консенсусе

**Исходный код:** [consensus.rs#L382-L389](https://github.com/efir369999/junomontanaagibot/blob/main/Montana%20ACP/montana/src/consensus.rs#L382-L389)

```rust
// User Present (UP) — физическое касание устройства
if flags & 0x01 == 0 {
    return Err(PresenceError::Fido2UserNotPresent);
}

// User Verified (UV) — биометрия (отпечаток/лицо)
if flags & 0x04 == 0 {
    return Err(PresenceError::Fido2UserNotVerified);
}
```

### 2.2 Два уровня узлов

| Уровень | Верификация | Доля консенсуса |
|---------|-------------|-----------------|
| Full Node | Только ключ | 80% |
| Verified User | Ключ + FIDO2 | 20% |

---

## 3. Протокол верификации

### 3.1 Attestation flow

```
┌─────────────────────────────────────────────────────────────┐
│  1. Узел получает challenge от сети                         │
│  2. Пользователь касается устройства (UP=1)                 │
│  3. Устройство проверяет отпечаток/лицо (UV=1)              │
│  4. Secure Element подписывает attestation                  │
│  5. Узел отправляет подписанный presence proof              │
│  6. Сеть проверяет флаги UP и UV                            │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 Случайный интервал (Anti-Bot)

**Исходный код:** [consensus.rs](https://github.com/efir369999/junomontanaagibot/blob/main/Montana%20ACP/montana/src/consensus.rs)

```rust
// Verified User должен подтвердить присутствие
// в случайный момент в окне 10-40 минут
// Бот не может предсказать когда
```

---

## 4. Защита от атак

| Атака | Защита | Механизм |
|-------|--------|----------|
| Кража ключа | Нужна биометрия | UV флаг обязателен |
| Удалённый бот | Нужно касание | UP флаг обязателен |
| Replay | Challenge-Response | Свежий challenge каждый раз |
| Фейковое устройство | Secure Element | Attestation от hardware |

---

## 5. Научная новизна

1. **FIDO2 в консенсусе** — первый блокчейн с биометрией на уровне протокола
2. **Двухфакторный консенсус** — ключ + биометрия для права голоса
3. **Anti-Bot** — случайный интервал делает автоматизацию невозможной
4. **Гибрид 80/20** — серверы без биометрии + люди с биометрией

---

## 6. Ссылки

| Документ | Ссылка |
|----------|--------|
| Консенсус код | [consensus.rs](https://github.com/efir369999/junomontanaagibot/blob/main/Montana%20ACP/montana/src/consensus.rs) |
| FIDO2 спецификация | [WebAuthn W3C](https://www.w3.org/TR/webauthn-2/) |
| ACP Консенсус | [001_ACP.md](001_ACP.md) |

---

```
Alejandro Montana
Montana Protocol v1.0
Январь 2026

github.com/efir369999/junomontanaagibot
```
