# ะะะะขะะะะ TIME_BANK v3.0 โ ะะฐะฝะบ ะัะตะผะตะฝะธ Montana

## ะะตััะธั: 3.0
## ะะฐัะฐ: 2026-01-20
## ะะฒัะพั: Alejandro Montana

---

## 1. ะะะะะะซะ ะะะะะฆะะ

**ะะะะกะฃะขะกะขะะะ = ะะะะะะะะะะกะขะะะ**

> ะะพะบะฐ ัั ะพะฑัะฐะตัััั ั ะฎะฝะพะฝะพะน โ ัั ะฟัะธัััััะฒัะตัั.
> ะะพะบะฐ ัะทะตะป ัะฐะฑะพัะฐะตั โ ะัะปะฐะฝั ะฟัะธัััััะฒัะตั.
>
> **1 ษ = 1 ัะตะบัะฝะดะฐ ะดะพะบะฐะทะฐะฝะฝะพะณะพ ะฟัะธัััััะฒะธั.**

---

## 2. ะะะ ะขะะะ ะะะะกะฃะขะกะขะะะฏ

### 2.1 ะะพะปัะทะพะฒะฐัะตะปั (Telegram)

```
ะัะธัััััะฒะธะต = ะะทะฐะธะผะพะดะตะนััะฒะธะต ั ะฑะพัะพะผ

ะกะพะพะฑัะตะฝะธะต/ะะพะผะฐะฝะดะฐ/ะะฝะพะฟะบะฐ โ activity(telegram_id) โ +1 ษ/ัะตะบ
```

**ะะบัะธะฒะฝะพััั:**
- ะัะฟัะฐะฒะธะป ัะพะพะฑัะตะฝะธะต โ ะฟัะธัััััะฒัะตั
- ะัะทะฒะฐะป ะบะพะผะฐะฝะดั โ ะฟัะธัััััะฒัะตั
- ะะฐะถะฐะป ะบะฝะพะฟะบั โ ะฟัะธัััััะฒัะตั
- ะะพะปัะธั > 1 ะผะธะฝััั (ฯโ) โ ะฟะฐัะทะฐ

**ะะพะด ะฒ ะฑะพัะต:**
```python
# ะะฐะถะดะพะต ะฒะทะฐะธะผะพะดะตะนััะฒะธะต = ะฟัะธัััััะฒะธะต
time_bank.activity(str(user_id), "telegram")
```

### 2.2 ะัะปะฐะฝั (ะกะตัะฒะตั/ะฃะทะตะป)

```
ะัะปะฐะฝั ะะกะะะะ ะฟัะธัััััะฒัะตั (ะฟะพะบะฐ ัะฐะฑะพัะฐะตั)

ะกัะฐัั ะฑะพัะฐ โ atlant_presence_loop() โ +1 ษ/ัะตะบ (ะฟะพััะพัะฝะฝะพ)
```

**ะะพะณะธะบะฐ:**
- ะัะปะฐะฝั = ัะตัะฒะตั, ะฝะฐ ะบะพัะพัะพะผ ัะฐะฑะพัะฐะตั ะฑะพั
- ะะพะบะฐ ะฑะพั ัะฐะฑะพัะฐะตั โ ะัะปะฐะฝั ะฟัะธัััััะฒัะตั
- ะะธะฝะณ ะบะฐะถะดัะต 60 ัะตะบ ะฟะพะดะดะตัะถะธะฒะฐะตั ะฐะบัะธะฒะฝะพััั

**ะะพะด ะฒ ะฑะพัะต:**
```python
async def atlant_presence_loop():
    atlant_address = f"atlant_{node_name}"
    time_bank.start(atlant_address, "atlant")

    while _is_polling:
        time_bank.activity(atlant_address, "atlant")
        await asyncio.sleep(60)

    time_bank.end(atlant_address)
```

---

## 3. ะะะะะะะะซะ ะะะะะะะะะขะซ

### ะะตัะฐััะธั ะฒัะตะผะตะฝะธ Montana

| ะฃัะพะฒะตะฝั | ะะฝัะตัะฒะฐะป | ะะฟะธัะฐะฝะธะต |
|---------|----------|----------|
| ฯโ | 1 ะผะธะฝััะฐ | ะะพะดะฟะธัั ะฟัะธัััััะฒะธั (ML-DSA-65) |
| ฯโ (T2) | 10 ะผะธะฝัั | ะกะปะฐะนั, ะฟะพะดัะฒะตัะถะดะตะฝะธะต ะฑะฐะปะฐะฝัะฐ |
| ฯโ | 14 ะดะฝะตะน | Checkpoint |
| ฯโ | 4 ะณะพะดะฐ | Epoch, ะฅะฐะปะฒะธะฝะณ รท2 |

### T2 โ ะัะฝะพะฒะฝะพะน ัะธะบะป

```
[0 ัะตะบ] โโโโโโโโโโโโโโโโโโโโโโโโโโโ [600 ัะตะบ]
         T2 = 10 ะผะธะฝัั

Pending ัะตะบัะฝะดั โโโ ะะะะขะะะะะะะะะ โโโ ะะฐะปะฐะฝั
(ะฒ ะบััะต)                              (ะฒ ะะ)
```

**ะะฐะถะดัะต 10 ะผะธะฝัั:**
1. ะัะต ะฝะฐะบะพะฟะปะตะฝะฝัะต `t2_seconds` ะบะพะฝะฒะตััะธัััััั ะฒ ะฑะฐะปะฐะฝั
2. ะะฐะปะฐะฝั ะทะฐะฟะธััะฒะฐะตััั ะฒ ะะ
3. ะกััััะธะบ `t2_seconds` ัะฑัะฐััะฒะฐะตััั

---

## 4. ะะะฅะะะะะ ะะะงะะกะะะะะฏ

### 4.1 ะะพัะพะบ ะดะฐะฝะฝัั

```
ะะพะปัะทะพะฒะฐัะตะปั                           ะัะปะฐะฝั
     โ                                    โ
     โ ัะพะพะฑัะตะฝะธะต                     ัะฐะฑะพัะฐะตั
     โผ                                    โผ
activity(tg_id)                   activity(atlant_id)
     โ                                    โ
     โโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโ
                โ
                โผ
         โโโโโโโโโโโโโโโ
         โ PresenceCache โ
         โ entries[addr] โ
         โ  t2_seconds++ โ
         โโโโโโโโฌโโโโโโโ
                โ ะบะฐะถะดัั ัะตะบัะฝะดั (_tick)
                โ ะตัะปะธ ะฐะบัะธะฒะตะฝ < 3 ะผะธะฝ
                โผ
         โโโโโโโโโโโโโโโ
         โ  T2 (10 ะผะธะฝ) โ
         โ _finalize_t2 โ
         โโโโโโโโฌโโโโโโโ
                โ
                โผ
         โโโโโโโโโโโโโโโ
         โ    DB       โ
         โ balance += N โ
         โโโโโโโโโโโโโโโ
```

### 4.2 ะะพะด ะฝะฐัะธัะปะตะฝะธั (time_bank.py)

```python
def _tick(self):
    """ะะฐะถะดัั ัะตะบัะฝะดั"""
    for address, entry in self.presence.all().items():
        inactive = now - entry["last_activity"]

        if inactive < INACTIVITY_LIMIT_SEC:  # < 3 ะผะธะฝ
            entry["presence_seconds"] += 1
            entry["t2_seconds"] += 1
        else:
            entry["is_active"] = False  # ะะฐัะทะฐ

def _finalize_t2(self):
    """ะะฐะถะดัะต 10 ะผะธะฝัั"""
    for address, entry in self.presence.all().items():
        if entry["t2_seconds"] > 0:
            coins = int(entry["t2_seconds"] * halving_coefficient)
            self.db.credit(address, coins)
            entry["t2_seconds"] = 0
```

---

## 5. ะะะะกะขะะะขะซ ะะะะขะะะะะ

```python
class Protocol:
    VERSION = "3.0"

    # ะัะตะผั
    INACTIVITY_LIMIT_SEC = 1 * 60       # ฯโ = 1 ะผะธะฝััะฐ ะฑะตะท ะฐะบัะธะฒะฝะพััะธ = ะฟะฐัะทะฐ
    T2_DURATION_SEC = 10 * 60           # 10 ะผะธะฝัั = ัะปะฐะนั
    TAU3_DURATION_SEC = 14 * 24 * 3600  # 14 ะดะฝะตะน = checkpoint
    TAU4_DURATION_SEC = 4 * 365 * 86400 # 4 ะณะพะดะฐ = epoch

    # ะะฐัะธัะปะตะฝะธะต
    COINS_PER_SECOND = 1                # 1 ัะตะบัะฝะดะฐ = 1 ษ

    # ะกะตัั
    NODES_COUNT = 5                     # 5 ัะทะปะพะฒ Montana
```

---

## 6. ะฅะะะะะะ

**ะญะผะธััะธั ะดะตะปะธััั ะฝะฐ 2 ะบะฐะถะดัะต ฯโ (4 ะณะพะดะฐ)**

| Epoch (ฯโ) | ะะพะดั | ะะพัััะธัะธะตะฝั | 1 ัะตะบ = |
|------------|------|-------------|---------|
| 0 | 0-4 | 1.0 | 1 ษ |
| 1 | 4-8 | 0.5 | 0.5 ษ |
| 2 | 8-12 | 0.25 | 0.25 ษ |
| 3 | 12-16 | 0.125 | 0.125 ษ |

```python
def halving_coefficient(tau4_count: int) -> float:
    return 1.0 / (2 ** tau4_count)
```

---

## 7. ะะะะะะก ะ ะะะขะ

### ะะพะผะฐะฝะดะฐ /balance

```
ษ

**ะขะฒะพะน ะบะพัะตะปะตะบ Montana**

**ะะดัะตั:** `123456789`
_(ัะฒะพะน Telegram ID โ ะฐะดัะตั ะบะพัะตะปัะบะฐ ะธ ะบะปัั)_

๐ฐ **ะะฐะปะฐะฝั:** 1200 ษ
โณ **ะะฐะบะฐะฟะปะธะฒะฐะตััั:** +45 ษ
โโโโโโโโโโโโโโโโโโโโโโโโโ
๐ **ะัะตะณะพ:** 1245 ษ

โฑ ะกะปะตะดัััะตะต ะฟะพะดัะฒะตัะถะดะตะฝะธะต ัะตัะตะท 7:32
```

**ะะฒะฐ ัะธะฟะฐ ะฑะฐะปะฐะฝัะฐ:**
- `confirmed` โ ะฟะพะดัะฒะตัะถะดัะฝะฝัะน (ะฒ ะะ)
- `pending` โ ะฝะฐะบะฐะฟะปะธะฒะฐะตััั ะฒ ัะตะบััะตะผ T2 (ะฒ ะบััะต)

---

## 8. ะะะะะกะ

### ะขะธะฟั ะฐะดัะตัะพะฒ

| ะขะธะฟ | ะคะพัะผะฐั | ะัะธะผะตั |
|-----|--------|--------|
| ะะพะปัะทะพะฒะฐัะตะปั | Telegram ID | `8552053404` |
| ะัะปะฐะฝั | `atlant_{node_name}` | `atlant_amsterdam` |
| ะฃะทะตะป | `mt + SHA256(pubkey)[:40]` | `mt1a2b3c4d...` |

---

## 9. ะะะะะขะะะะะคะะฏ

### ML-DSA-65 Presence Proof

ะะฐะถะดัั ฯโ (1 ะผะธะฝััั) ัะทะตะป ะฟะพะดะฟะธััะฒะฐะตั ะดะพะบะฐะทะฐัะตะปัััะฒะพ ะฟัะธัััััะฒะธั:

```
MONTANA_PRESENCE_V1:{timestamp}:{prev_hash}:{pubkey}:{t2_index}
```

**ะฆะตะฟะพัะบะฐ proofs:**
```
Proof #1 โ hashโ
              โ
Proof #2 (prev=hashโ) โ hashโ
              โ
Proof #3 (prev=hashโ) โ hashโ
```

---

## 10. ะกะขะะขะะกะขะะะ /stats

```
ษ

**๐ Montana Protocol โ ะกัะฐัะธััะธะบะฐ**

**โฑ ะัะตะผะตะฝะฝัะต ะะพะพัะดะธะฝะฐัั**
โ ฯโ (ัะตะบััะธะน slice): #1234
โ ฯโ (checkpoints): #5
โ ฯโ (epoch): #0
โ ะะพะด Montana: 0

**๐ฐ ะญะผะธััะธั**
โ ะะพัััะธัะธะตะฝั ัะฐะปะฒะธะฝะณะฐ: 1.0ร
โ 1 ัะตะบัะฝะดะฐ ะฟัะธัััััะฒะธั = 1 ษ

**๐ ะกะตัั**
โ ะะบัะธะฒะฝะพะต ะฟัะธัััััะฒะธะต: 3
โ ะัะตะณะพ ะบะพัะตะปัะบะพะฒ: 15
```

---

## 11. ะคะะะะกะะคะะฏ

> **ะัะตะผั โ ะตะดะธะฝััะฒะตะฝะฝัะน ัะตัััั, ัะฐัะฟัะตะดะตะปัะฝะฝัะน ะพะดะธะฝะฐะบะพะฒะพ ะผะตะถะดั ะฒัะตะผะธ.**
>
> 24 ัะฐัะฐ ั ะบะฐะถะดะพะณะพ. Montana ะพัะธััะพะฒัะฒะฐะตั ััะพ ะฟัะธัััััะฒะธะต.
>
> ะัะธัััััะฒะธะต = ะะทะฐะธะผะพะดะตะนััะฒะธะต.
> ะัะปะฐะฝั = ะกะตัะฒะตั, ะบะพัะพััะน ะดะตัะถะธั ัะตัั.
>
> **1 ษ = 1 ัะตะบัะฝะดะฐ ัะฒะพะตะน ะถะธะทะฝะธ, ะดะพะบะฐะทะฐะฝะฝะพะน ะฟัะธัััััะฒะธะตะผ.**

---

## 12. ะกะขะะขะฃะก ะะะะะะะะฆะะ

```
โ v3.0 โ PRODUCTION
   โ ะัะธัััััะฒะธะต ะฟะพะปัะทะพะฒะฐัะตะปะตะน (Telegram)
   โ ะัะธัััััะฒะธะต ะัะปะฐะฝัะพะฒ (ัะตัะฒะตัั)
   โ T2 ะฟะพะดัะฒะตัะถะดะตะฝะธะต (10 ะผะธะฝ)
   โ ะฅะฐะปะฒะธะฝะณ (4 ะณะพะดะฐ)
   โ ML-DSA-65 Presence Proof
   โ SQLite ััะฐะฝะธะปะธัะต
```

---

**ะะพะดะฟะธัั ะฟัะพัะพะบะพะปะฐ:**

```
ะะะะขะะะะ: TIME_BANK v3.0
ะะะขะ: 2026-01-20
ะะะขะะ: Alejandro Montana
ะกะขะะขะฃะก: MAINNET PRODUCTION
้ๅษ
```
