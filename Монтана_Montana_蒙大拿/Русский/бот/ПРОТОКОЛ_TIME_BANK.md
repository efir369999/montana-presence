# ПРОТОКОЛ TIME_BANK — Банк Времени Montana

## Версия: 1.0
## Дата: 2026-01-19
## Автор: 金元Ɉ

---

## 1. ОПРЕДЕЛЕНИЕ

**TIME_BANK** — протокол начисления монет времени (Ɉ coins) за присутствие в сети Montana.

Принцип: **1 секунда присутствия = 1 монета Ɉ**

---

## 2. ПРАВИЛА НАЧИСЛЕНИЯ

### 2.1 Активное присутствие

```
WHILE user.isActive:
    presenceSeconds++
    IF presenceSeconds % AWARD_INTERVAL == 0:
        awardCoins(presenceSeconds)
```

- Счётчик секунд присутствия запускается при входе в приложение
- Пока пользователь активен — секунды начисляются
- Активность = любое взаимодействие (сообщение, касание, скролл)

### 2.2 Определение неактивности

```
INACTIVITY_LIMIT = 3 * 60 * 1000  // 3 минуты
timeSinceLastActivity = now() - lastActivityTimestamp

IF timeSinceLastActivity > INACTIVITY_LIMIT:
    pauseCounter()
```

- Если пользователь неактивен более **3 минут** — счётчик останавливается
- Статус меняется на "Пауза"
- При возобновлении активности — счётчик продолжает

### 2.3 Интервал начисления

```
AWARD_INTERVAL = 10 * 60  // 600 секунд = 10 минут
COINS_PER_SECOND = 1

coinsEarned = AWARD_INTERVAL * COINS_PER_SECOND  // 600 монет
```

- Каждые **10 минут** активного присутствия
- Начисляется **600 монет Ɉ** (1 монета × 600 секунд)
- Юнона показывает уведомление о начислении

---

## 3. ХРАНЕНИЕ

### 3.1 Локальное хранилище

```javascript
localStorage.setItem('montana_coins', totalCoins.toString())
```

- Монеты сохраняются в localStorage браузера
- Ключ: `montana_coins`
- Персистентность между сессиями

### 3.2 Серверная синхронизация (v2.0)

```python
# Планируется в следующей версии
def sync_coins(user_id, coins):
    db.users.update(user_id, {'coins': coins})
```

---

## 4. ВИЗУАЛИЗАЦИЯ

### 4.1 Presence Bar

```
┌─────────────────────────────────────┐
│ ● Присутствие: 05:23    Ɉ 1200     │
└─────────────────────────────────────┘
```

- Зелёная точка — активен
- Красная точка — пауза
- Счётчик времени MM:SS
- Баланс монет справа

### 4.2 Состояния

| Состояние | Индикатор | Цвет |
|-----------|-----------|------|
| Активен   | ● мигает  | Зелёный (#4ade80) |
| Пауза     | ●         | Красный (#ff6b6b) |

### 4.3 Уведомление о награде

```
┌────────────────────────────┐
│           Ɉ               │
│   Юнона начислила         │
│        +600               │
│ монет времени за          │
│ 10 минут присутствия      │
└────────────────────────────┘
```

---

## 5. ЭКОНОМИКА

### 5.1 Формула

```
totalCoins = sum(activeSessions * COINS_PER_SECOND)
```

### 5.2 Прогнозы

| Время присутствия | Монеты Ɉ |
|-------------------|----------|
| 10 минут          | 600      |
| 1 час             | 3,600    |
| 1 день (8ч)       | 28,800   |
| 1 неделя          | 201,600  |
| 1 месяц           | 864,000  |

### 5.3 Философия

> Время — единственный ресурс, распределённый одинаково между всеми.
> 24 часа у каждого. Montana оцифровывает это присутствие.
>
> **1 Ɉ = 1 секунда твоей жизни, доказанной присутствием.**

---

## 6. API ENDPOINTS (v2.0)

### 6.1 Получить баланс

```
GET /api/coins?user_id={id}

Response:
{
  "user_id": 123456789,
  "coins": 28800,
  "last_sync": "2026-01-19T12:00:00Z"
}
```

### 6.2 Синхронизация

```
POST /api/coins/sync

Body:
{
  "user_id": 123456789,
  "coins": 28800,
  "session_seconds": 600
}
```

---

## 7. ТЕХНИЧЕСКИЕ КОНСТАНТЫ

```javascript
// Протокол TIME_BANK v1.0
const TIME_BANK = {
    VERSION: '1.0',
    INACTIVITY_LIMIT_MS: 3 * 60 * 1000,    // 3 минуты
    AWARD_INTERVAL_SEC: 10 * 60,            // 10 минут
    COINS_PER_SECOND: 1,                    // 1:1 секунда = монета
    STORAGE_KEY: 'montana_coins',
    AWARD_POPUP_DURATION_MS: 3000           // 3 секунды показа
};
```

---

## 8. ИНТЕГРАЦИЯ С ГИППОКАМПОМ

Каждое начисление записывается в Внешний Гиппокамп:

```json
{
  "timestamp": "2026-01-19T12:10:00Z",
  "event": "TIME_BANK_AWARD",
  "user_id": 123456789,
  "coins_awarded": 600,
  "total_coins": 28800,
  "session_seconds": 600,
  "source": "miniapp"
}
```

---

## 9. БЕЗОПАСНОСТЬ

- Счётчик работает только при активном взаимодействии
- Невозможно накрутить просто оставив приложение открытым
- 3 минуты без активности = пауза
- Серверная валидация в v2.0

---

## 10. СТАТУС

```
✅ v1.0 — Локальный счётчик (localStorage)
⏳ v2.0 — Серверная синхронизация
⏳ v3.0 — Blockchain запись (опционально)
```

---

**Подпись протокола:**

```
ПРОТОКОЛ: TIME_BANK v1.0
ДАТА: 2026-01-19
АВТОР: 金元Ɉ
СТАТУС: PRODUCTION
金元Ɉ
```
