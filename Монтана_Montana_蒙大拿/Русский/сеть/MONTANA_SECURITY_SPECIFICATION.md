# Montana Protocol ‚Äî Security Specification
# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–∞—â–∏—Ç—ã —Å–µ—Ç–∏ –∏ –±–æ—Ç–∞

**Version:** 1.0
**Status:** ‚úÖ Implemented
**Date:** January 2026
**Authors:** Alejandro Montana, Claude Sonnet 4.5

---

## Abstract / –ê–±—Å—Ç—Ä–∞–∫—Ç

Montana Protocol ‚Äî —ç—Ç–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞, –æ—Å–Ω–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è –≤–æ –≤—Ä–µ–º–µ–Ω–∏ (Atemporal Coordinate Presence, ACP). –î–∞–Ω–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö, —Å–µ—Ç–µ–≤—ã—Ö –∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã—Ö –∑–∞—â–∏—Ç–Ω—ã—Ö –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏—Ö –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ Montana –æ—Ç –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤ –∞—Ç–∞–∫, –≤–∫–ª—é—á–∞—è –∫–≤–∞–Ω—Ç–æ–≤—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è, —Å–µ—Ç–µ–≤—ã–µ DDoS, –∞—Ç–∞–∫–∏ —Ç–∏–ø–∞ Sybil, –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–µ–º, –∏ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—é —É–∑–ª–æ–≤.

–ö–ª—é—á–µ–≤—ã–µ –∑–∞—â–∏—Ç–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã:
- **ML-DSA-65 (FIPS 204)** ‚Äî –ø–æ—Å—Ç–∫–≤–∞–Ω—Ç–æ–≤–∞—è —Ü–∏—Ñ—Ä–æ–≤–∞—è –ø–æ–¥–ø–∏—Å—å
- **3-Mirror Leader Election** ‚Äî —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ–∑ –µ–¥–∏–Ω–æ–π —Ç–æ—á–∫–∏ –æ—Ç–∫–∞–∑–∞
- **Attack Detection + Random Failover** ‚Äî –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∞—Ç–∞–∫ –∏ –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞
- **Breathing Sync** ‚Äî git-based —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ç–∏
- **Temporal Coordinates (œÑ‚ÇÅ, œÑ‚ÇÇ, œÑ‚ÇÉ, œÑ‚ÇÑ)** ‚Äî –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
- **Halving Mechanism** ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–∞—è –¥–µ—Ñ–ª—è—Ü–∏–æ–Ω–Ω–∞—è —ç–º–∏—Å—Å–∏—è
- **User Approval System** ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- **Process Isolation** ‚Äî –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ Telegram API

---

## Table of Contents / –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [Cryptographic Security ‚Äî –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#1-cryptographic-security)
2. [Network Security ‚Äî –°–µ—Ç–µ–≤–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#2-network-security)
3. [Attack Detection and Mitigation ‚Äî –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏ —Å–º—è–≥—á–µ–Ω–∏–µ –∞—Ç–∞–∫](#3-attack-detection-and-mitigation)
4. [Consensus Security ‚Äî –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞](#4-consensus-security)
5. [Temporal Security ‚Äî –í—Ä–µ–º–µ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#5-temporal-security)
6. [Access Control ‚Äî –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞](#6-access-control)
7. [Process and API Security ‚Äî –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏ API](#7-process-and-api-security)
8. [Economic Security ‚Äî –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#8-economic-security)
9. [Code Implementation ‚Äî –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ –∫–æ–¥–µ](#9-code-implementation)
10. [Attack Surface Analysis ‚Äî –ê–Ω–∞–ª–∏–∑ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –∞—Ç–∞–∫–∏](#10-attack-surface-analysis)
11. [Future Improvements ‚Äî –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è](#11-future-improvements)

---

## 1. Cryptographic Security ‚Äî –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 1.1 ML-DSA-65 (FIPS 204) Post-Quantum Signatures

**Threat Model / –ú–æ–¥–µ–ª—å —É–≥—Ä–æ–∑:**
- –ö–≤–∞–Ω—Ç–æ–≤—ã–µ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã –º–æ–≥—É—Ç –≤–∑–ª–æ–º–∞—Ç—å ECDSA –∏ RSA —á–µ—Ä–µ–∑ –∞–ª–≥–æ—Ä–∏—Ç–º –®–æ—Ä–∞
- –ê—Ç–∞–∫–∏ —Ç–∏–ø–∞ "Harvest Now, Decrypt Later" ‚Äî —Å–±–æ—Ä –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –±—É–¥—É—â–µ–π —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏

**Solution / –†–µ—à–µ–Ω–∏–µ:**

Montana Protocol –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **ML-DSA-65** (Module Lattice Digital Signature Algorithm, —Ä–∞–Ω–µ–µ –∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–∞–∫ Dilithium), —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–æ–≤–∞–Ω–Ω—ã–π NIST –∫–∞–∫ FIPS 204.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| –ê–ª–≥–æ—Ä–∏—Ç–º | ML-DSA-65 (Dilithium) |
| –°—Ç–∞–Ω–¥–∞—Ä—Ç | FIPS 204 (NIST) |
| –£—Ä–æ–≤–µ–Ω—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ | NIST Level 3 (—ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç 128-bit AES –ø—Ä–æ—Ç–∏–≤ –∫–≤–∞–Ω—Ç–æ–≤—ã—Ö –∞—Ç–∞–∫) |
| Private Key | 4032 –±–∞–π—Ç–∞ |
| Public Key | 1952 –±–∞–π—Ç–∞ |
| Signature | 3309 –±–∞–π—Ç |
| –û—Å–Ω–æ–≤–∞ | Module Learning With Errors (MLWE) |

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Montana:**

–ö–∞–∂–¥—É—é œÑ‚ÇÅ (1 –º–∏–Ω—É—Ç–∞) —É–∑–µ–ª –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç **Presence Proof**:

```
message = "MONTANA_PRESENCE_V1:{timestamp}:{prev_hash}:{pubkey}:{t2_index}"
signature = ML-DSA-65.sign(node_private_key, message)
proof_hash = SHA256(message || signature)
```

**–°–≤–æ–π—Å—Ç–≤–∞:**
- ‚úÖ –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –∫–≤–∞–Ω—Ç–æ–≤—ã–º –∞—Ç–∞–∫–∞–º (Shor's algorithm)
- ‚úÖ –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ Grover's algorithm (–ø–æ–∏—Å–∫ –∫–æ–ª–ª–∏–∑–∏–π)
- ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–¥–µ–ª–∫–∏ –ø–æ–¥–ø–∏—Å–∏ –±–µ–∑ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞
- ‚úÖ –¶–µ–ø–æ—á–∫–∞ Presence Proofs —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –Ω–µ–∏–∑–º–µ–Ω—è–µ–º—É—é –∏—Å—Ç–æ—Ä–∏—é

**Code Reference:**
- `–ú–æ–Ω—Ç–∞–Ω–∞_Montana_ËíôÂ§ßÊãø/–†—É—Å—Å–∫–∏–π/–±–æ—Ç/node_crypto.py` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π, –ø–æ–¥–ø–∏—Å—å, –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è
- `–ú–æ–Ω—Ç–∞–Ω–∞_Montana_ËíôÂ§ßÊãø/–†—É—Å—Å–∫–∏–π/–±–æ—Ç/time_bank.py:271-327` ‚Äî –ø–æ–¥–ø–∏—Å—å Presence Proof

---

### 1.2 Presence Proof Chain

**Threat Model:**
- –ü–æ–¥–º–µ–Ω–∞ –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è
- –§–æ—Ä–∫–∏ —Ü–µ–ø–æ—á–∫–∏ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤
- –£–¥–∞–ª–µ–Ω–∏–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤ –∑–∞–¥–Ω–∏–º —á–∏—Å–ª–æ–º

**Solution:**

–¶–µ–ø–æ—á–∫–∞ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç **–æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫** —Å –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–º–∏ —Ö–µ—à–∞–º–∏:

```
Genesis Proof
  prev_hash = "0000...0000" (64 –Ω—É–ª—è)
  ‚Üì
Proof #1 (T2 #0, œÑ‚ÇÅ #0)
  prev_hash = Genesis.hash
  timestamp = 1737360000
  signature = ML-DSA-65(message)
  proof_hash = SHA256(message || signature)
  ‚Üì
Proof #2 (T2 #0, œÑ‚ÇÅ #1)
  prev_hash = Proof#1.hash
  timestamp = 1737360060
  signature = ML-DSA-65(message)
  proof_hash = SHA256(message || signature)
  ‚Üì
...
```

**–°–≤–æ–π—Å—Ç–≤–∞:**
- ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–æ—à–ª—ã–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ (hash chain)
- ‚úÖ –õ—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Ä—É—à–∞–µ—Ç —Ü–µ–ø–æ—á–∫—É —Ö–µ—à–µ–π
- ‚úÖ Genesis hash –∏–∑–≤–µ—Å—Ç–µ–Ω –∏ –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω –≤ –ø—Ä–æ—Ç–æ–∫–æ–ª–µ
- ‚úÖ –ö–∞–∂–¥–∞—è œÑ‚ÇÅ (60 —Å–µ–∫—É–Ω–¥) = –Ω–æ–≤—ã–π proof

**–ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫:**
- **Replay Attack:** timestamp + prev_hash –¥–µ–ª–∞—é—Ç –∫–∞–∂–¥—ã–π proof —É–Ω–∏–∫–∞–ª—å–Ω—ã–º
- **Fork Attack:** Genesis hash –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö —Ü–µ–ø–æ—á–µ–∫
- **Deletion Attack:** –ü–æ–ª–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞

**Code Reference:**
- `time_bank.py:271-327` ‚Äî `_sign_presence_proof()`
- `time_bank.py:329-354` ‚Äî `verify_presence_proof()`

---

## 2. Network Security ‚Äî –°–µ—Ç–µ–≤–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 2.1 3-Mirror Leader Election

**Threat Model:**
- –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –æ—Ç–∫–∞–∑–∞ (Single Point of Failure)
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (centralized control)
- –ö–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—è –º–∞—Å—Ç–µ—Ä-—É–∑–ª–∞

**Solution:**

Montana –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Ü–µ–ø–æ—á–∫—É –∏–∑ 5 —É–∑–ª–æ–≤** —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º failover:

```python
BOT_CHAIN = [
    ("amsterdam",   "72.56.102.240"),    # PRIMARY
    ("moscow",      "176.124.208.93"),   # MIRROR 1
    ("almaty",      "91.200.148.93"),    # MIRROR 2
    ("spb",         "188.225.58.98"),    # MIRROR 3
    ("novosibirsk", "147.45.147.247"),   # MIRROR 4
]
```

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

```
def am_i_the_master():
    for (name, ip) in BOT_CHAIN:
        if name == my_name:
            return True  # –î–æ—à–ª–∏ –¥–æ —Å–µ–±—è - —è –º–∞—Å—Ç–µ—Ä
        if is_node_alive(ip):
            return False  # –ö—Ç–æ-—Ç–æ –≤—ã—à–µ –º–µ–Ω—è –∂–∏–≤ - –æ–Ω –º–∞—Å—Ç–µ—Ä
    return False
```

**–°–≤–æ–π—Å—Ç–≤–∞:**
- ‚úÖ Failover < 10 —Å–µ–∫—É–Ω–¥
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ (CHECK_INTERVAL)
- ‚úÖ Ping + TCP fallback (–ø–æ—Ä—Ç—ã 22, 443)
- ‚úÖ –ù–µ—Ç –µ–¥–∏–Ω–æ–π —Ç–æ—á–∫–∏ –æ—Ç–∫–∞–∑–∞
- ‚úÖ –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ (–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤)

**–ó–∞—â–∏—Ç–∞:**
- **Node Failure:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —É–∑–µ–ª
- **Network Partition:** –ö–∞–∂–¥—ã–π —É–∑–µ–ª –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ—Ö –≤—ã—à–µ —Å–µ–±—è
- **Split-Brain:** –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω —É–∑–µ–ª –º–æ–∂–µ—Ç –±—ã—Ç—å –º–∞—Å—Ç–µ—Ä–æ–º (–ø–µ—Ä–≤—ã–π –∂–∏–≤–æ–π)

**Code Reference:**
- `leader_election.py:199-230` ‚Äî `am_i_the_master()`
- `leader_election.py:265-326` ‚Äî `run_leader_loop()`

---

### 2.2 Breathing Sync (Git-based State Synchronization)

**Threat Model:**
- –†–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É —É–∑–ª–∞–º–∏
- –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–±–æ–µ —É–∑–ª–∞
- –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π –∫–æ–¥–∞

**Solution:**

**Breathing Sync** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Git –∫–∞–∂–¥—ã–µ 12 —Å–µ–∫—É–Ω–¥:

```
–¶–∏–∫–ª:
  –í–¥–æ—Ö (Inhale) ‚Äî git pull —Å rebase
    ‚Üì
  12 —Å–µ–∫—É–Ω–¥ —Ä–∞–±–æ—Ç—ã
    ‚Üì
  –í—ã–¥–æ—Ö (Exhale) ‚Äî git add + commit + push
    ‚Üì
  –ü–æ–≤—Ç–æ—Ä
```

**–†–µ–∂–∏–º—ã:**
- `only_when_master=True` ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è –º–∞—Å—Ç–µ—Ä–∞
- `is_master_func=lambda: self.is_master` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

**–°–≤–æ–π—Å—Ç–≤–∞:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ –í–µ—Ä—Å–∏–æ–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å —á–µ—Ä–µ–∑ Git
- ‚úÖ –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Ä–µ—à–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ rebase
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–ó–∞—â–∏—Ç–∞:**
- **Data Loss:** Git —Ö—Ä–∞–Ω–∏—Ç –ø–æ–ª–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é
- **Desync:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π pull –∫–∞–∂–¥—ã–µ 12 —Å–µ–∫—É–Ω–¥
- **Version Mismatch:** –í—Å–µ —É–∑–ª—ã –Ω–∞ –æ–¥–Ω–æ–º –∫–æ–º–º–∏—Ç–µ

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ:**
- ‚ö†Ô∏è –£—è–∑–≤–∏–º–æ—Å—Ç—å –∫ Git Bomb DoS (–Ω–µ—Ç –ª–∏–º–∏—Ç–∞ –Ω–∞ —Ä–∞–∑–º–µ—Ä pull) ‚Äî —Ç—Ä–µ–±—É–µ—Ç —Ñ–∏–∫—Å–∞

**Code Reference:**
- `breathing_sync.py` ‚Äî –ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- `leader_election.py:250-263` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

---

## 3. Attack Detection and Mitigation ‚Äî –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏ —Å–º—è–≥—á–µ–Ω–∏–µ –∞—Ç–∞–∫

### 3.1 Attack Detection Metrics

**Threat Model:**
- DDoS –∞—Ç–∞–∫–∏ (Distributed Denial of Service)
- CPU exhaustion attacks
- Network flooding
- Slowloris-style attacks (–º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã)

**Solution:**

Montana —Ä–µ–∞–ª–∏–∑—É–µ—Ç **AttackDetector** –∫–ª–∞—Å—Å —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏:

#### –ú–µ—Ç—Ä–∏–∫–∏ –∞—Ç–∞–∫:

| –ú–µ—Ç—Ä–∏–∫–∞ | –ü–æ—Ä–æ–≥ | –î–µ–π—Å—Ç–≤–∏–µ |
|---------|-------|----------|
| CPU Usage | > 80% | –§–ª–∞–≥ –∞—Ç–∞–∫–∏ |
| Network Traffic | > 100 MB/s –≤—Ö–æ–¥—è—â–µ–≥–æ | –§–ª–∞–≥ –∞—Ç–∞–∫–∏ |
| Failure Count | > 10 –ø–æ–¥—Ä—è–¥ | –§–ª–∞–≥ –∞—Ç–∞–∫–∏ |
| Response Time (avg) | > 5 —Å–µ–∫—É–Ω–¥ | –§–ª–∞–≥ –∞—Ç–∞–∫–∏ |

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

```python
class AttackDetector:
    def __init__(self):
        self.failure_count = 0
        self.max_failures = 10
        self.response_times = deque(maxlen=10)
        self.cpu_threshold = 80.0  # %
        self.response_time_threshold = 5.0  # sec
        self.under_attack = False

    def is_under_attack(self) -> bool:
        self.check_cpu_usage()
        self.check_network_traffic()
        return self.under_attack
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**

1. **CPU Usage:**
```python
cpu_percent = psutil.cpu_percent(interval=0.1)
if cpu_percent > 80%:
    under_attack = True
```

2. **Network Traffic:**
```python
bytes_per_sec = net_io.bytes_recv / elapsed_time
if bytes_per_sec > 100 MB/s:
    under_attack = True
```

3. **Failure Rate:**
```python
if failure_count >= 10:
    under_attack = True
```

4. **Response Time:**
```python
avg_response = sum(last_10_responses) / 10
if avg_response > 5 seconds:
    under_attack = True
```

**Code Reference:**
- `leader_election.py:125-232` ‚Äî `AttackDetector` –∫–ª–∞—Å—Å

---

### 3.2 Random Failover on Attack

**Threat Model:**
- –ê—Ç–∞–∫—É—é—â–∏–π –∑–Ω–∞–µ—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Ü–µ–ø–æ—á–∫—É —É–∑–ª–æ–≤
- –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ failover –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞—Ç–∞–∫–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —É–∑–µ–ª –∑–∞—Ä–∞–Ω–µ–µ
- Targeted attacks –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —É–∑–ª—ã –≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞

**Solution:**

–ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –∞—Ç–∞–∫–∏ Montana **–ø–µ—Ä–µ–º–µ—à–∏–≤–∞–µ—Ç —Ü–µ–ø–æ—á–∫—É —Å–ª—É—á–∞–π–Ω—ã–º –æ–±—Ä–∞–∑–æ–º**:

```python
def shuffle_chain_on_attack(self):
    if not self.attack_detector.is_under_attack():
        return

    logger.warning("üö® –ê–¢–ê–ö–ê –û–ë–ù–ê–†–£–ñ–ï–ù–ê! –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª—É—á–∞–π–Ω—ã–π failover")

    # –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º —Ü–µ–ø–æ—á–∫—É
    shuffled = list(self.chain)
    random.shuffle(shuffled)

    # –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –∂–∏–≤—ã–µ —É–∑–ª—ã
    healthy_nodes = [
        (name, ip) for (name, ip) in shuffled
        if check_node_health(ip)
    ]

    if healthy_nodes:
        self.chain = healthy_nodes
        self.chain_shuffled = True
        logger.info(f"üé≤ –ù–æ–≤—ã–π –ø–æ—Ä—è–¥–æ–∫: {' ‚Üí '.join([n for n, _ in self.chain])}")
```

**–°–≤–æ–π—Å—Ç–≤–∞:**
- ‚úÖ **–ù–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å:** –ê—Ç–∞–∫—É—é—â–∏–π –Ω–µ –º–æ–∂–µ—Ç —É–≥–∞–¥–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–≥–æ –º–∞—Å—Ç–µ—Ä–∞
- ‚úÖ **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Ç–æ–ø–æ–ª–æ–≥–∏—è:** –¶–µ–ø–æ—á–∫–∞ –º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–π –∞—Ç–∞–∫–µ
- ‚úÖ **–¢–æ–ª—å–∫–æ –∑–¥–æ—Ä–æ–≤—ã–µ —É–∑–ª—ã:** –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ `check_node_health()`
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π reset:** –ü–æ—Å–ª–µ failover `attack_detector.reset()`

**–ü—Ä–∏–º–µ—Ä:**

```
–ù–æ—Ä–º–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º:
amsterdam ‚Üí moscow ‚Üí almaty ‚Üí spb ‚Üí novosibirsk

–ê—Ç–∞–∫–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –Ω–∞ amsterdam:
üö® –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ...
üé≤ –ù–æ–≤—ã–π –ø–æ—Ä—è–¥–æ–∫: spb ‚Üí almaty ‚Üí moscow ‚Üí novosibirsk
(amsterdam –∏—Å–∫–ª—é—á–µ–Ω –∫–∞–∫ –º—ë—Ä—Ç–≤—ã–π)

–ê—Ç–∞–∫—É—é—â–∏–π –ù–ï –∑–Ω–∞–µ—Ç, –∫—Ç–æ —Å–ª–µ–¥—É—é—â–∏–π –º–∞—Å—Ç–µ—Ä
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
> "–ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –∞—Ç–∞—Ç–∫–∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –º–∞—Å—Ç–µ—Ä–∞ –≤ —Å–ª—É—á–∞–π–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ"

**Code Reference:**
- `leader_election.py:365-409` ‚Äî `shuffle_chain_on_attack()`
- `leader_election.py:479-488` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `run_leader_loop()`

---

## 4. Consensus Security ‚Äî –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞

### 4.1 Proof of Presence (–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è)

**Threat Model:**
- Sybil attacks (—Å–æ–∑–¥–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Ñ–µ–π–∫–æ–≤—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤)
- AFK farming (–Ω–∞–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏ –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è)
- Timestamp manipulation

**Solution:**

–ö–æ–Ω—Å–µ–Ω—Å—É—Å Montana –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ **—Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–∏ –≤–æ –≤—Ä–µ–º–µ–Ω–∏**:

```
1 —Å–µ–∫—É–Ω–¥–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è = 1 …à √ó halving_coefficient
```

**–ú–µ—Ö–∞–Ω–∏–∑–º:**

1. **–ù–∞—á–∞–ª–æ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è:**
```python
bank.start("user_123", "telegram")
# –°–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å —Å start_time = now()
```

2. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:**
```python
bank.activity("user_123")
# –û–±–Ω–æ–≤–ª—è–µ—Ç last_activity = now()
# –ï—Å–ª–∏ gap > 3 –º–∏–Ω—É—Ç—ã ‚Üí –ø–∞—É–∑–∞
```

3. **–ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ —Å–µ–∫—É–Ω–¥:**
```python
# –ö–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É:
if is_active and (now - last_activity < 180 sec):
    presence_seconds += 1
    t2_seconds += 1
```

4. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ œÑ‚ÇÇ (10 –º–∏–Ω—É—Ç):**
```python
coins = t2_seconds √ó halving_coefficient
db.credit(address, coins)
t2_seconds = 0  # –°–±—Ä–æ—Å –¥–ª—è –Ω–æ–≤–æ–≥–æ œÑ‚ÇÇ
```

**–ó–∞—â–∏—Ç–∞:**
- **Sybil Attack:** ML-DSA-65 –∞–¥—Ä–µ—Å–∞, –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã
- **AFK Farming:** Inactivity limit = 3 –º–∏–Ω—É—Ç—ã –±–µ–∑ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ ‚Üí –ø–∞—É–∑–∞
- **Time Acceleration:** –í—Ä–µ–º—è –Ω–µ–ª—å–∑—è —É—Å–∫–æ—Ä–∏—Ç—å (—Å–∏—Å—Ç–µ–º–Ω–æ–µ `time.time()`)
- **Retroactive Claims:** Monets –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–∞ —Ç–µ–∫—É—â–∏–π œÑ‚ÇÇ

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- ‚ö†Ô∏è `time.time()` –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–º–µ–Ω—ë–Ω root-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (—Ç—Ä–µ–±—É–µ—Ç `time.monotonic()` + NTP)

**Code Reference:**
- `time_bank.py:221-269` ‚Äî `start()`, `activity()`, `end()`
- `time_bank.py:456-510` ‚Äî `_finalize_t2()` —Å halving

---

### 4.2 Inactivity Detection

**Threat Model:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç–∞ –∏ –æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–º–ø—å—é—Ç–µ—Ä (AFK)
- –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –º–æ–Ω–µ—Ç –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è
- –ë–æ—Ç—ã –∏–º–∏—Ç–∏—Ä—É—é—â–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

**Solution:**

```python
INACTIVITY_LIMIT_SEC = 3 * 60  # 3 –º–∏–Ω—É—Ç—ã

def _update_presence_seconds(self):
    now = time.time()
    for address, entry in self.presence.all().items():
        if not entry["is_active"]:
            continue

        idle_time = now - entry["last_activity"]
        if idle_time > INACTIVITY_LIMIT_SEC:
            # –ü–ê–£–ó–ê
            entry["is_active"] = False
            logger.info(f"‚è∏Ô∏è {address} ‚Äî –ø–∞—É–∑–∞ (idle {idle_time:.0f}s)")
        else:
            # –ù–∞—á–∏—Å–ª—è–µ–º —Å–µ–∫—É–Ω–¥—ã
            entry["presence_seconds"] += 1
            entry["t2_seconds"] += 1
```

**–°–≤–æ–π—Å—Ç–≤–∞:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–∞—É–∑–∞ —á–µ—Ä–µ–∑ 3 –º–∏–Ω—É—Ç—ã –±–µ–∑ `activity()`
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –Ω–æ–≤—ã–π –≤—ã–∑–æ–≤ `activity()`
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–∞—É–∑

**Code Reference:**
- `time_bank.py:426-454` ‚Äî `_update_presence_seconds()`

---

## 5. Temporal Security ‚Äî –í—Ä–µ–º–µ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 5.1 Temporal Coordinates (œÑ‚ÇÅ, œÑ‚ÇÇ, œÑ‚ÇÉ, œÑ‚ÇÑ)

**Threat Model:**
- –ú–∞–Ω–∏–ø—É–ª—è—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏
- –ù–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –º–µ–∂–¥—É —É–∑–ª–∞–º–∏
- –ü—Ä–æ–ø—É—Å–∫ checkpoints

**Solution:**

Montana –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–∏–µ—Ä–∞—Ä—Ö–∏—é –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç**:

| –ï–¥–∏–Ω–∏—Ü–∞ | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|--------------|------------|
| **œÑ‚ÇÅ** | 60 —Å–µ–∫—É–Ω–¥ (1 –º–∏–Ω—É—Ç–∞) | –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø–æ–¥–ø–∏—Å–∏ Presence Proof |
| **œÑ‚ÇÇ** | 600 —Å–µ–∫—É–Ω–¥ (10 –º–∏–Ω—É—Ç) | –°–ª–∞–π—Å —ç–º–∏—Å—Å–∏–∏ (–∞–Ω–∞–ª–æ–≥ –±–ª–æ–∫–∞) |
| **œÑ‚ÇÉ** | 1,209,600 —Å–µ–∫—É–Ω–¥ (14 –¥–Ω–µ–π) | Checkpoint —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ |
| **œÑ‚ÇÑ** | 126,144,000 —Å–µ–∫—É–Ω–¥ (4 –≥–æ–¥–∞) | –≠–ø–æ—Ö–∞ —Ö–∞–ª–≤–∏–Ω–≥–∞ |

**–ò–µ—Ä–∞—Ä—Ö–∏—è:**

```
1 œÑ‚ÇÑ = 104 œÑ‚ÇÉ = 209,664 œÑ‚ÇÇ = 126,144,000 —Å–µ–∫—É–Ω–¥
1 œÑ‚ÇÉ = 2016 œÑ‚ÇÇ = 1,209,600 —Å–µ–∫—É–Ω–¥
1 œÑ‚ÇÇ = 600 —Å–µ–∫—É–Ω–¥
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:**

```python
# Checkpoint œÑ‚ÇÉ
if t2_count % Protocol.T2_PER_TAU3 == 0:
    tau3_count += 1
    logger.info(f"œÑ‚ÇÉ CHECKPOINT #{tau3_count} ‚Äî 14 –î–ù–ï–ô")

# Halving œÑ‚ÇÑ
if tau3_count % Protocol.TAU3_PER_TAU4 == 0:
    tau4_count += 1
    logger.info(f"œÑ‚ÇÑ HALVING #{tau4_count} ‚Äî –≠–ú–ò–°–°–ò–Ø √∑ 2")
```

**–°–≤–æ–π—Å—Ç–≤–∞:**
- ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å checkpoint (—Å—á—ë—Ç—á–∏–∫–∏)
- ‚úÖ Halving –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ œÑ‚ÇÑ
- ‚úÖ –í—Å–µ —É–∑–ª—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ø–æ œÑ‚ÇÇ

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ö†Ô∏è –°—á—ë—Ç—á–∏–∫–∏ `tau3_count`, `tau4_count` –Ω–µ –ø–µ—Ä—Å–∏—Å—Ç—è—Ç –≤ –ë–î (—Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ)
- ‚ö†Ô∏è –ù—É–∂–µ–Ω –º–µ—Ö–∞–Ω–∏–∑–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ –ë–î –∏–ª–∏ blockchain

**Code Reference:**
- `time_bank.py:44-80` ‚Äî –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
- `time_bank.py:489-510` ‚Äî checkpoints
- `temporal_coordinates.py` ‚Äî —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏

---

### 5.2 Timestamp Integrity

**Threat Model:**
- –£–∑–µ–ª —Å –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–º —Å–∏—Å—Ç–µ–º–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º
- –ü–æ–¥–ø–∏—Å—å Presence Proof —Å –Ω–µ–≤–µ—Ä–Ω—ã–º timestamp
- –§–æ—Ä–∫–∏ —Ü–µ–ø–æ—á–∫–∏ –∏–∑-–∑–∞ –Ω–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

**Solution:**

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ Presence Proof:**

```python
message = f"{Protocol.PRESENCE_PROOF_VERSION}:{timestamp}:{prev_hash}:{pubkey}:{t2_index}"
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**

```python
def verify_presence_proof(self, proof: Dict[str, Any]) -> bool:
    # 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å—å ML-DSA-65
    if not verify_signature(public_key, message, signature):
        return False

    # 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ timestamp —Ä–∞–∑—É–º–Ω—ã–π (–Ω–µ –∏–∑ –±—É–¥—É—â–µ–≥–æ/–ø—Ä–æ—à–ª–æ–≥–æ)
    now = time.time()
    if abs(proof["timestamp"] - now) > 300:  # 5 –º–∏–Ω—É—Ç tolerance
        logger.warning("‚ö†Ô∏è Timestamp —Å–ª–∏—à–∫–æ–º –¥–∞–ª—ë–∫ –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏")
        return False

    # 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º prev_hash
    if proof["prev_hash"] != expected_prev_hash:
        return False

    return True
```

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- ‚ö†Ô∏è –°–µ–π—á–∞—Å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è Presence Proofs **–ù–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–ê** (–≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è, –Ω–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è)

**Code Reference:**
- `time_bank.py:329-354` ‚Äî `verify_presence_proof()` (—Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏)

---

## 6. Access Control ‚Äî –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞

### 6.1 User Approval System

**Threat Model:**
- –ù–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –±–æ—Ç—É
- –°–ø–∞–º –æ—Ç –Ω–µ–æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –û–±—Ö–æ–¥ –º–æ–¥–µ—Ä–∞—Ü–∏–∏

**Solution:**

**–î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞:**

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—è–≤–∫–∞:**
```python
@router.message(CommandStart())
async def start_cmd(message: Message):
    user_id = message.from_user.id

    if user_id == BOT_CREATOR_ID:
        # –í–ª–∞–¥–µ–ª–µ—Ü —Å—Ä–∞–∑—É –æ–¥–æ–±—Ä–µ–Ω
        save_user(user_id, approved=True)
    else:
        # –ó–∞—è–≤–∫–∞ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é
        save_user(user_id, pending_approval=True)
        await bot.send_message(
            BOT_CREATOR_ID,
            f"–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ –æ—Ç {user_id}"
        )
```

2. **–†—É—á–Ω–∞—è –º–æ–¥–µ—Ä–∞—Ü–∏—è:**
```python
@router.message(Command("approve"))
async def approve_cmd(message: Message):
    if message.from_user.id != BOT_CREATOR_ID:
        return

    target_user_id = extract_user_id(message.text)
    save_user(target_user_id, approved=True)
```

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥–æ–π:**
```python
async def check_user_approved(update: Update, user_id: int) -> bool:
    if user_id == BOT_CREATOR_ID:
        return True

    user_data = get_user(user_id)
    if user_data.get('approved', False):
        return True

    # –û—Ç–∫–ª–æ–Ω–µ–Ω–æ
    await update.message.reply_text("‚ùå –î–æ—Å—Ç—É–ø –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω")
    return False
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**

```python
async def balance_cmd(message: Message):
    user_id = message.from_user.id
    if not await check_user_approved(message, user_id):
        return  # –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—É

    # –ö–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
    balance = bank.balance(user_id)
```

**–°–≤–æ–π—Å—Ç–≤–∞:**
- ‚úÖ –¢–æ–ª—å–∫–æ `BOT_CREATOR_ID` –º–æ–∂–µ—Ç –æ–¥–æ–±—Ä—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –æ–¥–æ–±—Ä–µ–Ω–∏–µ
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Å—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ö†Ô∏è Race condition –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∫–æ–º–∞–Ω–¥—ã
- ‚ö†Ô∏è –ù—É–∂–µ–Ω –∞—Ç–æ–º–∞—Ä–Ω—ã–π check+action —Å user lock

**Code Reference:**
- `junomontanaagibot.py:121-149` ‚Äî `check_user_approved()`
- `junomontanaagibot.py:200-547` ‚Äî –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–æ–≤–µ—Ä–∫—É

---

## 7. Process and API Security ‚Äî –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏ API

### 7.1 Telegram Bot Process Isolation

**Threat Model:**
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –±–æ—Ç–∞ (409 Conflict)
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç `getUpdates` –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏
- –ó–∞–≤–∏—Å—à–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –ø–æ—Å–ª–µ —Å–±–æ—è

**Solution:**

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π kill —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:**

```python
def kill_existing_bot_processes():
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—Å–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –±–æ—Ç–∞.
    –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç getUpdates –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –Ω–æ–≤–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞.
    """
    ps_output = subprocess.check_output(['ps', 'aux'], text=True)
    lines = ps_output.split('\n')

    killed_count = 0
    for line in lines:
        if 'junomontanaagibot.py' in line and 'grep' not in line:
            pid = int(parts[1])
            if pid != os.getpid():
                os.kill(pid, signal.SIGKILL)
                killed_count += 1

    if killed_count > 0:
        time.sleep(10)  # –û–∂–∏–¥–∞–Ω–∏–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è Telegram API
```

**–í—ã–∑–æ–≤ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ:**

```python
if __name__ == '__main__':
    kill_existing_bot_processes()  # –£–±–∏–≤–∞–µ–º —Å—Ç–∞—Ä—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã

    # –û—á–∏—Å—Ç–∫–∞ API
    await bot.delete_webhook(drop_pending_updates=True)
    await bot.get_updates(offset=-1, timeout=1)

    # –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–≤–æ–π–Ω–æ–≥–æ polling
    with _polling_lock:
        if _is_polling:
            return
        _is_polling = True

    application.run_polling(drop_pending_updates=True)
```

**–°–≤–æ–π—Å—Ç–≤–∞:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π kill –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
- ‚úÖ –û—á–∏—Å—Ç–∫–∞ Telegram API webhook + pending updates
- ‚úÖ Thread lock –ø—Ä–æ—Ç–∏–≤ –¥–≤–æ–π–Ω–æ–≥–æ polling

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- ‚ö†Ô∏è Telegram API –¥–µ—Ä–∂–∏—Ç —Å–µ—Å—Å–∏—é 30-60 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ kill (409 –≤—Å—ë —Ä–∞–≤–Ω–æ –≤–æ–∑–º–æ–∂–µ–Ω)
- ‚ö†Ô∏è –õ–æ–∫–∞–ª—å–Ω—ã–π fcntl lock –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–∞–º–∏ (split-brain)

**Code Reference:**
- `junomontanaagibot.py:1124-1164` ‚Äî `kill_existing_bot_processes()`
- `junomontanaagibot.py:1161-1173` ‚Äî polling protection

---

## 8. Economic Security ‚Äî –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 8.1 Halving Mechanism (–î–µ—Ñ–ª—è—Ü–∏—è)

**Threat Model:**
- –ë–µ–∑–∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è –∏–Ω—Ñ–ª—è—Ü–∏—è
- –û–±–µ—Å—Ü–µ–Ω–∏–≤–∞–Ω–∏–µ –º–æ–Ω–µ—Ç—ã —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
- –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è —ç–º–∏—Å—Å–∏—è

**Solution:**

**–•–∞–ª–≤–∏–Ω–≥ –∫–∞–∂–¥—ã–µ œÑ‚ÇÑ (4 –≥–æ–¥–∞):**

```python
def halving_coefficient(tau4_count: int) -> float:
    """
    –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ö–∞–ª–≤–∏–Ω–≥–∞ ‚Äî –¥–µ–ª–µ–Ω–∏–µ –Ω–∞ 2 –∫–∞–∂–¥—ã–µ œÑ‚ÇÑ

    –§–æ—Ä–º—É–ª–∞:
        emission_per_second = 1.0 / (2 ** tau4_count)
    """
    return 1.0 / (2 ** tau4_count)
```

**–¢–∞–±–ª–∏—Ü–∞ —ç–º–∏—Å—Å–∏–∏:**

| –≠–ø–æ—Ö–∞ œÑ‚ÇÑ | –ì–æ–¥—ã | –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç | 1 —Å–µ–∫—É–Ω–¥–∞ = | –í—Å–µ–≥–æ –∑–∞ —ç–ø–æ—Ö—É |
|----------|------|-------------|-------------|----------------|
| 0 | 1-4 | 1.0 | 1.0 …à | 126,144,000 …à |
| 1 | 5-8 | 0.5 | 0.5 …à | 63,072,000 …à |
| 2 | 9-12 | 0.25 | 0.25 …à | 31,536,000 …à |
| 3 | 13-16 | 0.125 | 0.125 …à | 15,768,000 …à |
| ... | ... | ... | ... | ... |
| 64 | ~260 –ª–µ—Ç | ~0 | ~0 …à | ~0 …à |

**–ü—Ä–µ–¥–µ–ª —ç–º–∏—Å—Å–∏–∏ (–≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—è):**

```
Total Supply = 126,144,000 √ó (1 + 0.5 + 0.25 + 0.125 + ...)
             = 126,144,000 √ó 2
             = 252,288,000 …à
```

**–°–≤–æ–π—Å—Ç–≤–∞:**
- ‚úÖ –î–µ—Ñ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å (–∫–∞–∫ Bitcoin)
- ‚úÖ –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞—è —ç–º–∏—Å—Å–∏—è
- ‚úÖ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π supply –∏–∑–≤–µ—Å—Ç–µ–Ω

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ö†Ô∏è `tau4_count` –Ω–µ –ø–µ—Ä—Å–∏—Å—Ç–∏—Ç (—Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ)
- ‚ö†Ô∏è –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –¥–≤–æ–π–Ω–æ–π —ç–º–∏—Å—Å–∏–∏ –±–µ–∑ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ –ë–î

**Code Reference:**
- `halving.py:9-44` ‚Äî `halving_coefficient()`
- `time_bank.py:82-107` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ TIME_BANK

---

### 8.2 Fair Distribution (–ß–µ—Å—Ç–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ)

**Threat Model:**
- Premine (–∑–∞—Ä–∞–Ω–µ–µ –Ω–∞–º–∞–π–Ω–µ–Ω–Ω—ã–µ –º–æ–Ω–µ—Ç—ã)
- Insider advantage (–ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ –∏–Ω—Å–∞–π–¥–µ—Ä–æ–≤)
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å —ç–º–∏—Å—Å–∏–∏

**Solution:**

**–ü–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è —ç–º–∏—Å—Å–∏—è:**

```python
# –ö–∞–∂–¥—ã–π œÑ‚ÇÇ (10 –º–∏–Ω—É—Ç):
for address, entry in presence.all().items():
    if entry["t2_seconds"] > 0:
        coins = int(entry["t2_seconds"] √ó halving_coefficient)
        db.credit(address, coins)
```

**–ü—Ä–∏–Ω—Ü–∏–ø—ã:**
- ‚úÖ **–ù–µ—Ç premine:** –≠–º–∏—Å—Å–∏—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å Genesis (–ø–µ—Ä–≤—ã–π œÑ‚ÇÇ)
- ‚úÖ **–ù–µ—Ç ICO/IDO:** –ú–æ–Ω–µ—Ç—ã –Ω–µ–ª—å–∑—è –∫—É–ø–∏—Ç—å, —Ç–æ–ª—å–∫–æ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ–º
- ‚úÖ **–†–∞–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞:** –í—Å–µ –ø–æ–ª—É—á–∞—é—Ç 1 …à –∑–∞ 1 —Å–µ–∫—É–Ω–¥—É (—Å —É—á—ë—Ç–æ–º halving)
- ‚úÖ **–ü—É–±–ª–∏—á–Ω—ã–π –∫–æ–¥:** –í—Å—è –ª–æ–≥–∏–∫–∞ —ç–º–∏—Å—Å–∏–∏ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –∫–æ–¥–µ

---

## 9. Code Implementation ‚Äî –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ –∫–æ–¥–µ

### 9.1 Architecture Overview

```
Montana Protocol Stack:

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Telegram Bot (junomontanaagibot.py)                ‚îÇ
‚îÇ  - User commands                                    ‚îÇ
‚îÇ  - Approval system                                  ‚îÇ
‚îÇ  - Process isolation                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Leader Election (leader_election.py)               ‚îÇ
‚îÇ  - 3-Mirror failover                                ‚îÇ
‚îÇ  - Attack detection                                 ‚îÇ
‚îÇ  - Random failover                                  ‚îÇ
‚îÇ  - Breathing Sync                                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  TIME_BANK (time_bank.py)                           ‚îÇ
‚îÇ  - Presence tracking                                ‚îÇ
‚îÇ  - Halving mechanism                                ‚îÇ
‚îÇ  - Presence Proofs (ML-DSA-65)                      ‚îÇ
‚îÇ  - œÑ‚ÇÉ/œÑ‚ÇÑ checkpoints                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Database (time_db.py)                              ‚îÇ
‚îÇ  - Balances                                         ‚îÇ
‚îÇ  - Transactions                                     ‚îÇ
‚îÇ  - Users                                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 9.2 Key Files and Functions

#### **Cryptography:**

| –§–∞–π–ª | –§—É–Ω–∫—Ü–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|---------|------------|
| `node_crypto.py` | `sign_message()` | ML-DSA-65 –ø–æ–¥–ø–∏—Å—å |
| `node_crypto.py` | `verify_signature()` | ML-DSA-65 –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è |
| `node_crypto.py` | `get_node_crypto_system()` | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π |
| `time_bank.py:271-327` | `_sign_presence_proof()` | –ü–æ–¥–ø–∏—Å—å Presence Proof |
| `time_bank.py:329-354` | `verify_presence_proof()` | –ü—Ä–æ–≤–µ—Ä–∫–∞ Presence Proof |

#### **Network Security:**

| –§–∞–π–ª | –§—É–Ω–∫—Ü–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|---------|------------|
| `leader_election.py:199-230` | `am_i_the_master()` | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞ |
| `leader_election.py:53-114` | `check_node_health()` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —É–∑–ª–∞ |
| `leader_election.py:265-326` | `run_leader_loop()` | –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª failover |
| `breathing_sync.py` | `run_breathing_loop()` | Git —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è |

#### **Attack Detection:**

| –§–∞–π–ª | –§—É–Ω–∫—Ü–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|---------|------------|
| `leader_election.py:125-232` | `AttackDetector` | –ö–ª–∞—Å—Å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∞—Ç–∞–∫ |
| `leader_election.py:178-193` | `check_cpu_usage()` | –ü—Ä–æ–≤–µ—Ä–∫–∞ CPU |
| `leader_election.py:195-212` | `check_network_traffic()` | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∞—Ñ–∏–∫–∞ |
| `leader_election.py:365-409` | `shuffle_chain_on_attack()` | –°–ª—É—á–∞–π–Ω—ã–π failover |

#### **Consensus:**

| –§–∞–π–ª | –§—É–Ω–∫—Ü–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|---------|------------|
| `time_bank.py:221-269` | `start()`, `activity()`, `end()` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ–º |
| `time_bank.py:426-454` | `_update_presence_seconds()` | –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ —Å–µ–∫—É–Ω–¥ |
| `time_bank.py:456-510` | `_finalize_t2()` | –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ œÑ‚ÇÇ + —ç–º–∏—Å—Å–∏—è |
| `time_bank.py:82-107` | `halving_coefficient()` | –•–∞–ª–≤–∏–Ω–≥ |

#### **Access Control:**

| –§–∞–π–ª | –§—É–Ω–∫—Ü–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|---------|------------|
| `junomontanaagibot.py:121-149` | `check_user_approved()` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∏—è |
| `junomontanaagibot.py:153-198` | `start_cmd()` | –ó–∞—è–≤–∫–∞ –Ω–∞ –¥–æ—Å—Ç—É–ø |
| `junomontanaagibot.py:660-704` | `approve_cmd()` | –û–¥–æ–±—Ä–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |

---

## 10. Attack Surface Analysis ‚Äî –ê–Ω–∞–ª–∏–∑ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –∞—Ç–∞–∫–∏

### 10.1 Implemented Defenses (–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞—â–∏—Ç—ã)

| –ê—Ç–∞–∫–∞ | –ó–∞—â–∏—Ç–∞ | –°—Ç–∞—Ç—É—Å |
|-------|--------|--------|
| **Quantum Attacks** | ML-DSA-65 (FIPS 204) | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ |
| **DDoS / Resource Exhaustion** | Attack Detection (CPU, network) | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ |
| **Targeted Node Attack** | Random Failover on Attack | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ |
| **Node Failure** | 3-Mirror Leader Election | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ |
| **Sybil Attack** | ML-DSA-65 –∞–¥—Ä–µ—Å–∞ | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ |
| **AFK Farming** | Inactivity Limit (3 min) | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ |
| **Unauthorized Access** | User Approval System | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ |
| **Process Conflicts** | Auto-kill + Polling Lock | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ |
| **Inflation** | Halving Mechanism | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ |

### 10.2 Known Vulnerabilities (–ò–∑–≤–µ—Å—Ç–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏)

#### üî¥ CRITICAL:

1. **Split-Brain —á–µ—Ä–µ–∑ Local Lock**
   - `fcntl` lock —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω—ã–π (–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–∞–º–∏)
   - –î–≤–∞ —É–∑–ª–∞ –º–æ–≥—É—Ç –±—ã—Ç—å –º–∞—Å—Ç–µ—Ä–∞–º–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
   - **Fix:** Distributed lock (Redis, etcd, Consul)

2. **Halving Not Persisted**
   - `tau4_count` —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ
   - –†–∏—Å–∫ –¥–≤–æ–π–Ω–æ–π —ç–º–∏—Å—Å–∏–∏
   - **Fix:** –ü–µ—Ä—Å–∏—Å—Ç–∏—Ç—å —Å—á—ë—Ç—á–∏–∫–∏ –≤ –ë–î –∏–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –∏–∑ blockchain

3. **Time Manipulation**
   - `time.time()` –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —á–µ—Ä–µ–∑ root
   - –ü–æ–¥–¥–µ–ª—å–Ω—ã–µ timestamps
   - **Fix:** `time.monotonic()` + NTP —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

4. **Approval Bypass Race Condition**
   - Gap –º–µ–∂–¥—É `check_user_approved()` –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∫–æ–º–∞–Ω–¥—ã
   - **Fix:** –ê—Ç–æ–º–∞—Ä–Ω—ã–π check+action —Å user lock

#### üü† HIGH:

5. **Presence Proofs Not Verified**
   - ML-DSA-65 –ø–æ–¥–ø–∏—Å–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è, –Ω–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è
   - **Fix:** –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é –≤ `verify_presence_proof()`

6. **Git Bomb DoS**
   - Breathing Sync –Ω–µ—Ç –ª–∏–º–∏—Ç–∞ –Ω–∞ —Ä–∞–∑–º–µ—Ä pull
   - **Fix:** –õ–∏–º–∏—Ç—ã –Ω–∞ —Ä–∞–∑–º–µ—Ä git pull

#### üü° MEDIUM:

7. **Pending Balance UX**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç "total", –Ω–æ –Ω–µ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å "pending"
   - **Fix:** –ß—ë—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –≤ UI

8. **Genesis Hash Collision**
   - Static `GENESIS_HASH = "0" * 64`
   - **Fix:** –£–Ω–∏–∫–∞–ª—å–Ω—ã–π genesis hash

---

## 11. Future Improvements ‚Äî –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### 11.1 Short-term (1-3 –º–µ—Å—è—Ü–∞)

1. **Distributed Lock –¥–ª—è Leader Election**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Redis –∏–ª–∏ etcd
   - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å split-brain

2. **Persistence –¥–ª—è Halving Counters**
   - –°–æ—Ö—Ä–∞–Ω—è—Ç—å `tau3_count`, `tau4_count`, `t2_count` –≤ –ë–î
   - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞

3. **Real Presence Proof Verification**
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª–Ω—É—é –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é ML-DSA-65 –ø–æ–¥–ø–∏—Å–µ–π
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ–π —Ü–µ–ø–æ—á–∫–∏ –ø—Ä–∏ sync

4. **NTP Time Synchronization**
   - –ó–∞–º–µ–Ω–∞ `time.time()` –Ω–∞ `time.monotonic()` + NTP
   - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π –≤—Ä–µ–º–µ–Ω–µ–º

### 11.2 Medium-term (3-6 –º–µ—Å—è—Ü–µ–≤)

5. **Rate Limiting**
   - Per-user rate limits –Ω–∞ –∫–æ–º–∞–Ω–¥—ã
   - –ó–∞—â–∏—Ç–∞ –æ—Ç spam

6. **Git Pull Size Limits**
   - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ Breathing Sync
   - –ó–∞—â–∏—Ç–∞ –æ—Ç Git Bomb DoS

7. **Atomic User Action Locks**
   - –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ race conditions –≤ approval system
   - User-level locks –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### 11.3 Long-term (6-12 –º–µ—Å—è—Ü–µ–≤)

8. **Byzantine Fault Tolerance**
   - –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–ª–æ–Ω–∞–º–µ—Ä–µ–Ω–Ω—ã—Ö —É–∑–ª–æ–≤ (–Ω–µ —Ç–æ–ª—å–∫–æ —Å–±–æ–µ–≤)
   - –¢—Ä–µ–±—É–µ—Ç 2/3 –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞

9. **Cross-Chain Verification**
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ blockchain –¥–ª—è timestamp anchoring
   - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π

10. **Zero-Knowledge Proofs –¥–ª—è Privacy**
    - –°–∫—Ä—ã—Ç–∏–µ —Ç–æ—á–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –º–æ–Ω–µ—Ç
    - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–π –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

---

## Conclusion / –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

Montana Protocol —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—É—é –∑–∞—â–∏—Ç—É** –æ—Ç —à–∏—Ä–æ–∫–æ–≥–æ —Å–ø–µ–∫—Ç—Ä–∞ –∞—Ç–∞–∫:

- **–ü–æ—Å—Ç–∫–≤–∞–Ω—Ç–æ–≤–∞—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è (ML-DSA-65)** –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –±—É–¥—É—â–∏—Ö –∫–≤–∞–Ω—Ç–æ–≤—ã—Ö –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤
- **3-Mirror Leader Election** —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –µ–¥–∏–Ω—É—é —Ç–æ—á–∫—É –æ—Ç–∫–∞–∑–∞
- **Attack Detection + Random Failover** –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Ü–µ–ª–µ–≤—ã–µ –∞—Ç–∞–∫–∏ –Ω–∞ —É–∑–ª—ã
- **Temporal Coordinates** –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –≤—Ä–µ–º–µ–Ω–∏
- **Halving Mechanism** –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –∏–Ω—Ñ–ª—è—Ü–∏—é
- **User Approval System** –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

–ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ (split-brain, halving persistence, time manipulation), –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Montana –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç **—Å–∏–ª—å–Ω—É—é –∑–∞—â–∏—Ç—É** –¥–ª—è –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π —Å–µ—Ç–∏ —Å –∫–æ–Ω—Å–µ–Ω—Å—É—Å–æ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è.

–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã –≤ –±–ª–∏–∂–∞–π—à–∏—Ö —Ä–µ–ª–∏–∑–∞—Ö –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–∑–æ–≤—ã—Ö –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞.

---

```
Alejandro Montana
Montana Protocol Security Specification v1.0
January 2026

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>
```
