# Proof of Time Testnet
# 3-node local testnet for development and testing

version: '3.8'

services:
  # Seed node 1 (bootstrap)
  seed1:
    build:
      context: ..
      dockerfile: testnet/Dockerfile
    container_name: pot-seed1
    hostname: seed1
    ports:
      - "9333:9333"   # P2P
      - "9334:9334"   # RPC
    volumes:
      - seed1-data:/app/data
      - seed1-logs:/app/logs
    environment:
      - POT_NODE_NAME=seed1
      - POT_P2P_PORT=9333
      - POT_RPC_PORT=9334
      - POT_BOOTSTRAP=true
    networks:
      - pot-testnet
    restart: unless-stopped

  # Seed node 2
  seed2:
    build:
      context: ..
      dockerfile: testnet/Dockerfile
    container_name: pot-seed2
    hostname: seed2
    ports:
      - "9335:9333"
      - "9336:9334"
    volumes:
      - seed2-data:/app/data
      - seed2-logs:/app/logs
    environment:
      - POT_NODE_NAME=seed2
      - POT_P2P_PORT=9333
      - POT_RPC_PORT=9334
      - POT_BOOTSTRAP_PEERS=seed1:9333
    depends_on:
      - seed1
    networks:
      - pot-testnet
    restart: unless-stopped

  # Seed node 3
  seed3:
    build:
      context: ..
      dockerfile: testnet/Dockerfile
    container_name: pot-seed3
    hostname: seed3
    ports:
      - "9337:9333"
      - "9338:9334"
    volumes:
      - seed3-data:/app/data
      - seed3-logs:/app/logs
    environment:
      - POT_NODE_NAME=seed3
      - POT_P2P_PORT=9333
      - POT_RPC_PORT=9334
      - POT_BOOTSTRAP_PEERS=seed1:9333,seed2:9333
    depends_on:
      - seed1
      - seed2
    networks:
      - pot-testnet
    restart: unless-stopped

  # Faucet service
  faucet:
    build:
      context: ..
      dockerfile: testnet/Dockerfile
    container_name: pot-faucet
    hostname: faucet
    ports:
      - "9340:8080"
    volumes:
      - faucet-data:/app/data
    environment:
      - POT_FAUCET_ENABLED=true
      - POT_FAUCET_AMOUNT=1000
      - POT_FAUCET_COOLDOWN=3600
      - POT_RPC_ENDPOINT=http://seed1:9334
    depends_on:
      - seed1
    networks:
      - pot-testnet
    command: ["python", "testnet/faucet.py"]
    restart: unless-stopped

  # Block explorer (optional)
  explorer:
    build:
      context: ..
      dockerfile: testnet/Dockerfile
    container_name: pot-explorer
    hostname: explorer
    ports:
      - "9341:8080"
    environment:
      - POT_RPC_ENDPOINT=http://seed1:9334
    depends_on:
      - seed1
    networks:
      - pot-testnet
    command: ["python", "testnet/explorer.py"]
    restart: unless-stopped

volumes:
  seed1-data:
  seed1-logs:
  seed2-data:
  seed2-logs:
  seed3-data:
  seed3-logs:
  faucet-data:

networks:
  pot-testnet:
    driver: bridge
    ipam:
      config:
        - subnet: 172.28.0.0/16
